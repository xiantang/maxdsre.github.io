<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>TCP Study for Interviews - xiantang - Self-discipline set me free.</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="xiantang" /><meta name="description" content="What is TCP  TCP is a full-duplex, byte-stream protocol based on the IP protocol. TCP provides end-to-end accurate transmission.  Acknowledges each byte Handles poor network conditions  Timeout retransmission Congestion control   Efficiency improvement  Uses sliding window protocol     TCP is a connection-oriented protocol.  Since it is connection-oriented, how is this connection established?
That is, the following question is how to establish a virtual link using a three-way handshake." />






<meta name="generator" content="Hugo 0.91.2 with theme even" />


<link rel="canonical" href="https://vim0.com/en/post/network/tcp%E9%92%88%E5%AF%B9%E9%9D%A2%E8%AF%95%E5%AD%A6%E4%B9%A0/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.4747d1be8010357c5daf4cd103b0bc1cff65936180045419874ea97f32138102.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="TCP Study for Interviews" />
<meta property="og:description" content="What is TCP  TCP is a full-duplex, byte-stream protocol based on the IP protocol. TCP provides end-to-end accurate transmission.  Acknowledges each byte Handles poor network conditions  Timeout retransmission Congestion control   Efficiency improvement  Uses sliding window protocol     TCP is a connection-oriented protocol.  Since it is connection-oriented, how is this connection established?
That is, the following question is how to establish a virtual link using a three-way handshake." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vim0.com/en/post/network/tcp%E9%92%88%E5%AF%B9%E9%9D%A2%E8%AF%95%E5%AD%A6%E4%B9%A0/" /><meta property="og:image" content="https://vim0.com/post/main_cover.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-04-01T01:37:56+08:00" />
<meta property="article:modified_time" content="2020-04-01T01:37:56+08:00" /><meta property="og:site_name" content="xiantang - Self-discipline set me free." />

<meta itemprop="name" content="TCP Study for Interviews">
<meta itemprop="description" content="What is TCP  TCP is a full-duplex, byte-stream protocol based on the IP protocol. TCP provides end-to-end accurate transmission.  Acknowledges each byte Handles poor network conditions  Timeout retransmission Congestion control   Efficiency improvement  Uses sliding window protocol     TCP is a connection-oriented protocol.  Since it is connection-oriented, how is this connection established?
That is, the following question is how to establish a virtual link using a three-way handshake."><meta itemprop="datePublished" content="2020-04-01T01:37:56+08:00" />
<meta itemprop="dateModified" content="2020-04-01T01:37:56+08:00" />
<meta itemprop="wordCount" content="812"><meta itemprop="image" content="https://vim0.com/post/main_cover.png"/>
<meta itemprop="keywords" content="network," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://vim0.com/post/main_cover.png"/>

<meta name="twitter:title" content="TCP Study for Interviews"/>
<meta name="twitter:description" content="What is TCP  TCP is a full-duplex, byte-stream protocol based on the IP protocol. TCP provides end-to-end accurate transmission.  Acknowledges each byte Handles poor network conditions  Timeout retransmission Congestion control   Efficiency improvement  Uses sliding window protocol     TCP is a connection-oriented protocol.  Since it is connection-oriented, how is this connection established?
That is, the following question is how to establish a virtual link using a three-way handshake."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/en/" class="logo">xiantang</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/en">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/en/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/en/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/en/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/en/post/about/about_me/">
        <li class="mobile-menu-item">AboutMe</li>
      </a><a href="https://www.google.com/search?q=site%3Avim0.com">
        <li class="mobile-menu-item">Search</li>
      </a>
  </ul>

  

  <div class="language-selector">
    <ul class="languages-list">
      
        
        

        <li class="language-item ">
          
            <a href="https://vim0.com/post/network/tcp%E9%92%88%E5%AF%B9%E9%9D%A2%E8%AF%95%E5%AD%A6%E4%B9%A0/">zh-cn</a>
          
        </li>
      
        
        

        <li class="language-item active">
          
            <a href="https://vim0.com/en/post/network/tcp%E9%92%88%E5%AF%B9%E9%9D%A2%E8%AF%95%E5%AD%A6%E4%B9%A0/">en</a>
          
        </li>
      
    </ul>
  </div>


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/en/" class="logo">xiantang</a>
</div>



  <div class="language-selector">
    <ul class="languages-list">
      
        
        

        <li class="language-item ">
          
            <a href="https://vim0.com/post/network/tcp%E9%92%88%E5%AF%B9%E9%9D%A2%E8%AF%95%E5%AD%A6%E4%B9%A0/">zh-cn</a>
          
        </li>
      
        
        

        <li class="language-item active">
          
            <a href="https://vim0.com/en/post/network/tcp%E9%92%88%E5%AF%B9%E9%9D%A2%E8%AF%95%E5%AD%A6%E4%B9%A0/">en</a>
          
        </li>
      
    </ul>
  </div>



<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/en">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/post/about/about_me/">AboutMe</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://www.google.com/search?q=site%3Avim0.com">Search</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">TCP Study for Interviews</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-04-01 </span>
        <div class="post-category">
            <a href="/en/categories/english/"> English </a>
            <a href="/en/categories/network/"> network </a>
            </div>
          <span class="more-meta"> 812 words </span>
          <span class="more-meta"> 4 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#how-does-the-three-way-handshake-happen">How does the three-way handshake happen</a></li>
        <li><a href="#detailed-operation">Detailed operation</a></li>
        <li><a href="#why-shake-hands-three-times">Why shake hands three times</a></li>
        <li><a href="#how-does-the-four-way-handshake-occur">How does the four-way handshake occur</a></li>
        <li><a href="#detailed-operation-1">Detailed Operation</a></li>
        <li><a href="#why-a-four-way-handshake-is-needed">Why a four-way handshake is needed</a></li>
        <li><a href="#tcp-keepalive-vs-http-keepalive">TCP keepalive vs Http keepalive</a></li>
        <li><a href="#http">HTTP</a></li>
        <li><a href="#tcp">TCP</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="what-is-tcp">What is TCP</h1>
<ol>
<li>TCP is a full-duplex, byte-stream protocol based on the IP protocol.</li>
<li>TCP provides end-to-end accurate transmission.
<ol>
<li>Acknowledges each byte</li>
<li>Handles poor network conditions
<ol>
<li>Timeout retransmission</li>
<li>Congestion control</li>
</ol>
</li>
<li>Efficiency improvement
<ol>
<li>Uses sliding window protocol</li>
</ol>
</li>
</ol>
</li>
<li>TCP is a connection-oriented protocol.</li>
</ol>
<p>Since it is connection-oriented, how is this connection established?</p>
<p>That is, the following question is how to establish a virtual link using a three-way handshake.</p>
<h3 id="how-does-the-three-way-handshake-happen">How does the three-way handshake happen</h3>
<h3 id="detailed-operation">Detailed operation</h3>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gde7c4z6xrj30wn0u0tal.jpg" alt="image-20200331164958404"></p>
<p>I took a picture from the high-efficiency code, let&rsquo;s talk about the process of the three-way handshake:</p>
<ul>
<li>Machine A first calculates a seq index x to indicate the position of the current data packet and the packet is marked as SYN.</li>
<li>Machine B receives this packet and stores the data in the packet in its own buffer. Since the size of this packet is 1 byte, the index of the buffer is x + 1 synchronized to the seq position of the other party, returns a packet marked with SYN and ACK, and sends its own seq index y and tells the other party that it has received this data packet, so ack + 1.</li>
<li>Machine C receives this packet with ACK and SYN and needs to return an ACK to indicate that it can receive the other party&rsquo;s packet, so it sends an ACK and its current send seq and its receive seq.</li>
</ul>
<h3 id="why-shake-hands-three-times">Why shake hands three times</h3>
<p>As for why to shake hands three times</p>
<p>There are mainly two points:</p>
<h4 id="ensure-data-parity">Ensure data parity</h4>
<ol>
<li>
<p>First, it is necessary to ensure that the seq of both parties is the index of each other&rsquo;s reception and transmission buffer</p>
</li>
<li>
<p>Ensure each other&rsquo;s reception and transmission capabilities</p>
<p>The third handshake can guarantee the reporting ability of machine B and the receiving ability of machine A</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gde7c5z93tj316y0d6ju3.jpg" alt="image-20200331170448728"></p>
</li>
</ol>
<h4 id="preventing-dirty-connections">Preventing Dirty Connections</h4>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gde7c5ma90j30u00yidiz.jpg" alt="image-20200331171058004"></p>
<p>Machine A sends a SYN packet to Machine B, but this packet is not sent in time due to network reasons, and because the TCP timeout is less than TTL, if the TCP timeout is too long, the efficiency of resending packets will be slow.</p>
<p>So Machine A will send another TCP and establish a connection, at this time this packet has arrived at Machine B.</p>
<p>Machine B re-establishes the connection and returns an ACK to Machine A.</p>
<p>If there are only two handshakes, from the perspective of Machine B, the connection has been established, but when Machine A receives the Ack from Machine B, it is discarded directly because it is not SYN_SEND, and Machine B cannot perceive it, so Machine B has a unilateral dirty connection.</p>
<p>In the case of three handshakes, Machine B needs an ACK from Machine A to ensure its own sending ability and also avoid dirty connections. Machine A will not send ACK to Machine B, so from Machine B&rsquo;s perspective, there will be no connection.</p>
<h3 id="how-does-the-four-way-handshake-occur">How does the four-way handshake occur</h3>
<h3 id="detailed-operation-1">Detailed Operation</h3>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gde7c6fwquj30v90u0di1.jpg" alt="image-20200331174147939"></p>
<p>Ensure that both parties have completed data processing.</p>
<ul>
<li>Machine A sends remaining data and FIN to Machine B and is in FIN_WAIT</li>
<li>Machine B replies ACK to Machine A</li>
<li>Machine B waits for a CLOSE_WAIT and then sends the remaining data to Machine A</li>
<li>Machine A replies ACK indicating that the data has been received and waits for TIME_WAIT</li>
</ul>
<h3 id="why-a-four-way-handshake-is-needed">Why a four-way handshake is needed</h3>
<p>It is necessary to ensure that both parties have completed data processing and that they both know it.</p>
<p>The third handshake is because Machine A tells Machine B that it cannot transmit data and after Machine B ACKs, Machine B needs to wait for the application program to do a process before it can send a FIN to tell Machine A that it cannot transmit data.</p>
<p>The fourth handshake is to tell Machine B that it has accepted the fact that Machine B cannot send requests.</p>
<h3 id="tcp-keepalive-vs-http-keepalive">TCP keepalive vs Http keepalive</h3>
<h3 id="http">HTTP</h3>
<p>If keepalive = true is added to the Http header, multiple http requests will be on one TCP connection, and it will not handshake and wave as before for each request.</p>
<p>Advantages:</p>
<p>Reduce server load, under high concurrency servers, server load will decrease.</p>
<p>Reduce the time of each http request, because if it is an http request, there will be SSL or TSL behavior and three handshakes and four waves, so it will be slow, but it will not be like this if it is reduced to one connection.</p>
<h3 id="tcp">TCP</h3>
<p>It is maintained by the OS, because each TCP connection has various timers, and TCP also has a keepalive timer. When the keepalive timer of TCP reaches 0, it will send a probe packet with ACK turned on to the other party, because TCP is a stream-oriented protocol. On the other hand, you will receive a reply from the remote host. And the data of these two packets is empty.</p>
<p>Advantages:</p>
<p>Determine whether the other party is a dead peer</p>
<p>Prevent disconnection due to network inactivity.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">xiantang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-04-01
        
    </span>
  </p>
  
  
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">Reward</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://tva1.sinaimg.cn/large/006tNbRwly1gba9b3bbmwj30ha0hbq5e.jpg">
        <span>wechat</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://tva1.sinaimg.cn/large/006tNbRwly1gba9b4s82aj30ib0igad3.jpg">
        <span>alipay</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/en/tags/network/">network</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/en/post/interview/%E6%89%8B%E5%86%99%E5%8D%95%E4%BE%8B/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Singleton Pattern</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/en/post/scala/future_in_actor/">
            <span class="next-text nav-default">How Actor Handles Blocking Messages</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'xiantang';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/GIA917229015" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/xiantang" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/xian-tang-37-99" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="https://vim0.com/en/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2019 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>xiantang</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-9JZTKQCW5D"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9JZTKQCW5D', { 'anonymize_ip': true });
}
</script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-9JZTKQCW5D', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
