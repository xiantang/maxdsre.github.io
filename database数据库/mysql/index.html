<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>xiantang </title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.63.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.3f5912c237ddd38c8e76debe081c7ca7.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="" />
<meta property="og:description" content="索引的类型: B-Tree 索引 InnoDB 使用的是B&#43;Tree
根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下查找。通过要查找的值来找到合适的指针进入下层节点。
假设有如下数据表
create table people( last_name varchar(50) not null, first_name varchar(50) not null, dob date not null, gender enum(&#39;m&#39;,&#39;f&#39;) not null, key(last_name,first_name,dob) ); 对于表中的每一行数据，索引中包含了last_name,first_name 和 dob 列的值。 显示了该索引是如何组织数据存储的。
有效使用索引：
 全值匹配 匹配最左前缀 匹配列前缀 匹配范围值 精确匹配某一列并范围匹配另外一列 值访问索引  B-Tree 索引的限制：
 如果不是按照索引的最左侧开始查找，就无法使用索引。 不能跳过索引中的列，如果要查找姓名为 A 生日在 B 的人是只能使用索引的第一列。  B-树  内部节点:含有与页相关联的页的副本 外部节点:含有指向实际数据的引用 哨兵键:小于其他所有键，一开始B-树只含有
一个根节点，节点初始化出的就是哨兵节点  查找和插入 查找:在可能含有被查找键的唯一子树中进行一次递归的
搜索
插入: 如果被插入的节点变成一个溢出的节点
递归调用不断向上调用分裂溢出的节点
为什么使用B-Tree / B&#43;Tree 主要和硬盘的存取原理有关。 硬盘不是按需读取的，每次读取都会预读一些。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xiantang.github.io/database%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" />

<meta itemprop="name" content="">
<meta itemprop="description" content="索引的类型: B-Tree 索引 InnoDB 使用的是B&#43;Tree
根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下查找。通过要查找的值来找到合适的指针进入下层节点。
假设有如下数据表
create table people( last_name varchar(50) not null, first_name varchar(50) not null, dob date not null, gender enum(&#39;m&#39;,&#39;f&#39;) not null, key(last_name,first_name,dob) ); 对于表中的每一行数据，索引中包含了last_name,first_name 和 dob 列的值。 显示了该索引是如何组织数据存储的。
有效使用索引：
 全值匹配 匹配最左前缀 匹配列前缀 匹配范围值 精确匹配某一列并范围匹配另外一列 值访问索引  B-Tree 索引的限制：
 如果不是按照索引的最左侧开始查找，就无法使用索引。 不能跳过索引中的列，如果要查找姓名为 A 生日在 B 的人是只能使用索引的第一列。  B-树  内部节点:含有与页相关联的页的副本 外部节点:含有指向实际数据的引用 哨兵键:小于其他所有键，一开始B-树只含有
一个根节点，节点初始化出的就是哨兵节点  查找和插入 查找:在可能含有被查找键的唯一子树中进行一次递归的
搜索
插入: 如果被插入的节点变成一个溢出的节点
递归调用不断向上调用分裂溢出的节点
为什么使用B-Tree / B&#43;Tree 主要和硬盘的存取原理有关。 硬盘不是按需读取的，每次读取都会预读一些。">

<meta itemprop="wordCount" content="313">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="索引的类型: B-Tree 索引 InnoDB 使用的是B&#43;Tree
根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下查找。通过要查找的值来找到合适的指针进入下层节点。
假设有如下数据表
create table people( last_name varchar(50) not null, first_name varchar(50) not null, dob date not null, gender enum(&#39;m&#39;,&#39;f&#39;) not null, key(last_name,first_name,dob) ); 对于表中的每一行数据，索引中包含了last_name,first_name 和 dob 列的值。 显示了该索引是如何组织数据存储的。
有效使用索引：
 全值匹配 匹配最左前缀 匹配列前缀 匹配范围值 精确匹配某一列并范围匹配另外一列 值访问索引  B-Tree 索引的限制：
 如果不是按照索引的最左侧开始查找，就无法使用索引。 不能跳过索引中的列，如果要查找姓名为 A 生日在 B 的人是只能使用索引的第一列。  B-树  内部节点:含有与页相关联的页的副本 外部节点:含有指向实际数据的引用 哨兵键:小于其他所有键，一开始B-树只含有
一个根节点，节点初始化出的就是哨兵节点  查找和插入 查找:在可能含有被查找键的唯一子树中进行一次递归的
搜索
插入: 如果被插入的节点变成一个溢出的节点
递归调用不断向上调用分裂溢出的节点
为什么使用B-Tree / B&#43;Tree 主要和硬盘的存取原理有关。 硬盘不是按需读取的，每次读取都会预读一些。"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://xiantang.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      xiantang
    </a>
    <div class="flex-l items-center">
      

      
      













    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        DATABASE(数据库)S
      </p>
      <h1 class="f1 athelas mb1"></h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="0001-01-01T00:00:00Z">January 1, 0001</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id="索引的类型">索引的类型:</h2>
<h3 id="b-tree-索引">B-Tree 索引</h3>
<p>InnoDB 使用的是B+Tree<br>
<img src="../../../images/8394323_1307440587b6WG.jpg" alt="img"></p>
<p>根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下查找。通过要查找的值来找到合适的指针进入下层节点。</p>
<p>假设有如下数据表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> people(
    last_name varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
    first_name varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
    dob date <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
    gender enum(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">m</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
    <span style="color:#66d9ef">key</span>(last_name,first_name,dob)
);
</code></pre></div><p>对于表中的每一行数据，索引中包含了last_name,first_name 和 dob 列的值。 显示了该索引是如何组织数据存储的。</p>
<p><img src="muti.png" alt=""></p>
<p>有效使用索引：</p>
<ul>
<li>全值匹配</li>
<li>匹配最左前缀</li>
<li>匹配列前缀</li>
<li>匹配范围值</li>
<li>精确匹配某一列并范围匹配另外一列</li>
<li>值访问索引</li>
</ul>
<p>B-Tree 索引的限制：</p>
<ul>
<li>如果不是按照索引的最左侧开始查找，就无法使用索引。</li>
<li>不能跳过索引中的列，如果要查找姓名为 A 生日在 B 的人是只能使用索引的第一列。</li>
</ul>
<h3 id="b-树">B-树</h3>
<ul>
<li>内部节点:含有与页相关联的页的副本</li>
<li>外部节点:含有指向实际数据的引用</li>
<li>哨兵键:小于其他所有键，一开始B-树只含有<br>
一个根节点，节点初始化出的就是哨兵节点</li>
</ul>
<h4 id="查找和插入">查找和插入</h4>
<p>查找:在可能含有被查找键的唯一子树中进行一次递归的<br>
搜索<br>
<img src="https://img-blog.csdn.net/20170910224108969?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMjEyNDQzOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">
插入: <br>
如果被插入的节点变成一个溢出的节点<br>
递归调用不断向上调用分裂溢出的节点<br>
<img src="https://img-blog.csdn.net/20170910224922359?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMjEyNDQzOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h2 id="为什么使用b-tree--btree">为什么使用B-Tree / B+Tree</h2>
<p>主要和硬盘的存取原理有关。
硬盘不是按需读取的，每次读取都会预读一些。</p>
<pre><code>当一个数据被用到的时候，其附近的数据也会通常马上使用程序运行期间所需要的数据通常比较集中
</code></pre><p>一般预读的长度为页的整数倍</p>
<p>为什么使用B-Tree/B+Tree 不用红黑树<br>
出度大，并且高度小（通常不会超过3）</p>
<p>为什么使用 B+树</p>
<ul>
<li>适合外部存储，内部没有data域，一个索引节点可以存储多个节点，一个索引节点可以存储大量分支，每个节点能够索引的范围更大更精确，也意为着B+树单次IO信息量大于B- 树 I/O效率高</li>
<li>B+树查询必须找到叶子节点，B树只要匹配到就可以不管元素位置，而且更加稳定（并不慢）</li>
<li>B+树只要顺序遍历叶子节点，B树却需要重复的中序遍历。</li>
</ul>
<h2 id="数据库使用乐观锁">数据库使用乐观锁</h2>
<p>比较 交换</p>
<p>1.使用数据版本（Version）记录机制实现，这是乐观锁最常用的一种实现方式。何谓数据版本？即为数据增加一个版本标识，一般是通过为数据库表增加一个数字类型的 “version” 字段来实现。当读取数据时，将version字段的值一同读出，数据每更新一次，对此version值加一。当我们提交更新的时候，判断数据库表对应记录的当前版本信息与第一次取出来的version值进行比对，如果数据库表当前版本号与第一次取出来的version值相等，则予以更新，否则认为是过期数据。用下面的一张图来说明：</p>
<p><img src="http://dl.iteye.com/upload/picture/pic/125402/22a9518f-e355-315f-8d66-d91af4fda723.jpg" alt=""></p>
<p>使用举例：以MySQL InnoDB为例</p>
<p>还是拿之前的实例来举：商品goods表中有一个字段status，status为1代表商品未被下单，status为2代表商品已经被下单，那么我们对某个商品下单时必须确保该商品status为1。假设商品的id为1。</p>
<p>下单操作包括3步骤：</p>
<p>1.查询出商品信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> (status,status,<span style="color:#66d9ef">version</span>) <span style="color:#66d9ef">from</span> t_goods <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span>id<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>2.根据商品信息生成订单</p>
<p>3.修改商品status为2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">update</span> t_goods 

<span style="color:#66d9ef">set</span> status<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,<span style="color:#66d9ef">version</span><span style="color:#f92672">=</span><span style="color:#66d9ef">version</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span>id<span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">version</span><span style="color:#f92672">=</span><span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">version</span><span style="color:#960050;background-color:#1e0010">}</span>;
</code></pre></div><p>那么为了使用乐观锁，我们首先修改t_goods表，增加一个version字段，数据默认version值为1。</p>
<p>t_goods表初始数据如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> t_goods;  
<span style="color:#f92672">+</span><span style="color:#75715e">----+--------+------+---------+  
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> status <span style="color:#f92672">|</span> name <span style="color:#f92672">|</span> <span style="color:#66d9ef">version</span> <span style="color:#f92672">|</span>  
<span style="color:#f92672">+</span><span style="color:#75715e">----+--------+------+---------+  
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>      <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">道</span><span style="color:#960050;background-color:#1e0010">具</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>  
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>      <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">装</span><span style="color:#960050;background-color:#1e0010">备</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>  
<span style="color:#f92672">+</span><span style="color:#75715e">----+--------+------+---------+  
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>  
</code></pre></div><p>Goods实体类:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/** 
</span><span style="color:#75715e"> * ClassName: Goods &lt;br/&gt; 
</span><span style="color:#75715e"> * Function: 商品实体. &lt;br/&gt; 
</span><span style="color:#75715e"> * date: 2013-5-8 上午09:16:19 &lt;br/&gt; 
</span><span style="color:#75715e"> * @author chenzhou1025@126.com 
</span><span style="color:#75715e"> */</span>  
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Goods</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>  
  
    <span style="color:#75715e">/** 
</span><span style="color:#75715e">     * serialVersionUID:序列化ID. 
</span><span style="color:#75715e">     */</span>  
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> serialVersionUID <span style="color:#f92672">=</span> 6803791908148880587L<span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">/** 
</span><span style="color:#75715e">     * id:主键id. 
</span><span style="color:#75715e">     */</span>  
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">/** 
</span><span style="color:#75715e">     * status:商品状态：1未下单、2已下单. 
</span><span style="color:#75715e">     */</span>  
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> status<span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">/** 
</span><span style="color:#75715e">     * name:商品名称. 
</span><span style="color:#75715e">     */</span>  
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">/** 
</span><span style="color:#75715e">     * version:商品数据版本号. 
</span><span style="color:#75715e">     */</span>  
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> version<span style="color:#f92672">;</span>  
      
    <span style="color:#a6e22e">@Override</span>  
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>  
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;good id:&#34;</span><span style="color:#f92672">+</span>id<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,goods status:&#34;</span><span style="color:#f92672">+</span>status<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,goods name:&#34;</span><span style="color:#f92672">+</span>name<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,goods version:&#34;</span><span style="color:#f92672">+</span>version<span style="color:#f92672">;</span>  
    <span style="color:#f92672">}</span>  
  
    <span style="color:#75715e">//setter and getter  
</span><span style="color:#75715e"></span>  
<span style="color:#f92672">}</span>  
</code></pre></div><p>Dao</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Mapper</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">GoodsDao</span> <span style="color:#f92672">{</span>
        <span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select ID,status,name,version from t_goods where id=#{id}&#34;</span><span style="color:#f92672">)</span>
    Goods <span style="color:#a6e22e">getGood</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Param</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Update</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;  update t_goods \n&#34;</span> <span style="color:#f92672">+</span>
            <span style="color:#e6db74">&#34;        set status=#{status},name=#{name},version=version+1 \n&#34;</span> <span style="color:#f92672">+</span>
            <span style="color:#e6db74">&#34;        where id=#{id} and version=#{version}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>Goods goods<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>java 代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>  
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">goodsDaoTest</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>  
    <span style="color:#66d9ef">int</span> goodsId <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span>  
    <span style="color:#75715e">//根据相同的id查询出商品信息，赋给2个对象  
</span><span style="color:#75715e"></span>    Goods goods1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">goodsDao</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getGoodsById</span><span style="color:#f92672">(</span>goodsId<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
    Goods goods2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">goodsDao</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getGoodsById</span><span style="color:#f92672">(</span>goodsId<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">//打印当前商品信息  
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>goods1<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>goods2<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">//更新商品信息1  
</span><span style="color:#75715e"></span>    goods1<span style="color:#f92672">.</span><span style="color:#a6e22e">setStatus</span><span style="color:#f92672">(</span>2<span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//修改status为2  
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> updateResult1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">goodsDao</span><span style="color:#f92672">.</span><span style="color:#a6e22e">updateGoodsUseCAS</span><span style="color:#f92672">(</span>goods1<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;修改商品信息1&#34;</span><span style="color:#f92672">+</span><span style="color:#f92672">(</span>updateResult1<span style="color:#f92672">=</span><span style="color:#f92672">=</span>1<span style="color:#f92672">?</span><span style="color:#e6db74">&#34;成功&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;失败&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
      
    <span style="color:#75715e">//更新商品信息2  
</span><span style="color:#75715e"></span>    goods1<span style="color:#f92672">.</span><span style="color:#a6e22e">setStatus</span><span style="color:#f92672">(</span>2<span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//修改status为2  
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> updateResult2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">goodsDao</span><span style="color:#f92672">.</span><span style="color:#a6e22e">updateGoodsUseCAS</span><span style="color:#f92672">(</span>goods1<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;修改商品信息2&#34;</span><span style="color:#f92672">+</span><span style="color:#f92672">(</span>updateResult2<span style="color:#f92672">=</span><span style="color:#f92672">=</span>1<span style="color:#f92672">?</span><span style="color:#e6db74">&#34;成功&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;失败&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
<span style="color:#f92672">}</span>  
</code></pre></div><p>查出同一版本的数据，赋值给不同对象先对good1进行更新操作，执行成功，将version++。然后修改good2 这时候去比较version java对象的version 还是1 但是数据库的值已经是2了 所以就无法匹配了。</p>
<ol>
<li>按自然语言搜索模式查询
<code>SELECT * FROM articles WHERE MATCH (title,body) AGAINST ('关键词' IN NATURAL LANGUAGE MODE);</code></li>
</ol>
<ul class="pa0">
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://xiantang.github.io/" >
    &copy;  xiantang 2020 
  </a>
    <div>












</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
