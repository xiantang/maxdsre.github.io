<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>xiantang </title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.63.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.3f5912c237ddd38c8e76debe081c7ca7.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="" />
<meta property="og:description" content="容器 servlet 容器是用来处理servlet 资源，为Web 客户端填充 response 的模块
Tomcat 有4种容器:
 Engine 整个 Catalina servelt 引擎 Host 包含了一个或者多个Context 容器的虚拟主机 Context 表示一个web app 一个context 有多个Wrapper Wrapper 表示一个独立的servelt  这些容器都实现了Container 接口
我们的本章的上半部分主要讲解的是Wrapper 与 Context
Container 因为所有的容器都实现于Tomcat 的Container 接口所以我们讲解一下Container 接口
Container 主要需要实现的方法是 addChild() 和 removeChild()
/** * Add a new child Container to those associated with this Container, * if supported. Prior to adding this Container to the set of children, * the child&#39;s &lt;code&gt;setParent()&lt;/code&gt; method must be called, with this * Container as an argument." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xiantang.github.io/tomcat/tomcat-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-3-%E5%AE%B9%E5%99%A8/" />

<meta itemprop="name" content="">
<meta itemprop="description" content="容器 servlet 容器是用来处理servlet 资源，为Web 客户端填充 response 的模块
Tomcat 有4种容器:
 Engine 整个 Catalina servelt 引擎 Host 包含了一个或者多个Context 容器的虚拟主机 Context 表示一个web app 一个context 有多个Wrapper Wrapper 表示一个独立的servelt  这些容器都实现了Container 接口
我们的本章的上半部分主要讲解的是Wrapper 与 Context
Container 因为所有的容器都实现于Tomcat 的Container 接口所以我们讲解一下Container 接口
Container 主要需要实现的方法是 addChild() 和 removeChild()
/** * Add a new child Container to those associated with this Container, * if supported. Prior to adding this Container to the set of children, * the child&#39;s &lt;code&gt;setParent()&lt;/code&gt; method must be called, with this * Container as an argument.">

<meta itemprop="wordCount" content="501">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="容器 servlet 容器是用来处理servlet 资源，为Web 客户端填充 response 的模块
Tomcat 有4种容器:
 Engine 整个 Catalina servelt 引擎 Host 包含了一个或者多个Context 容器的虚拟主机 Context 表示一个web app 一个context 有多个Wrapper Wrapper 表示一个独立的servelt  这些容器都实现了Container 接口
我们的本章的上半部分主要讲解的是Wrapper 与 Context
Container 因为所有的容器都实现于Tomcat 的Container 接口所以我们讲解一下Container 接口
Container 主要需要实现的方法是 addChild() 和 removeChild()
/** * Add a new child Container to those associated with this Container, * if supported. Prior to adding this Container to the set of children, * the child&#39;s &lt;code&gt;setParent()&lt;/code&gt; method must be called, with this * Container as an argument."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://xiantang.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      xiantang
    </a>
    <div class="flex-l items-center">
      

      
      













    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        TOMCATS
      </p>
      <h1 class="f1 athelas mb1"></h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="0001-01-01T00:00:00Z">January 1, 0001</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h1 id="容器">容器</h1>
<p>servlet 容器是用来处理servlet 资源，为Web 客户端填充 response 的模块</p>
<p>Tomcat 有4种容器:</p>
<ul>
<li>Engine 整个 Catalina servelt 引擎</li>
<li>Host 包含了一个或者多个Context 容器的虚拟主机</li>
<li>Context 表示一个web app  一个context 有多个Wrapper</li>
<li>Wrapper 表示一个独立的servelt</li>
</ul>
<p>这些容器都实现了Container 接口</p>
<p>我们的本章的上半部分主要讲解的是Wrapper 与 Context</p>
<h2 id="container">Container</h2>
<p>因为所有的容器都实现于Tomcat 的Container 接口所以我们讲解一下Container 接口</p>
<p><img src="../doc/images/738818-20181211000636874-1536263943.png" alt="img"></p>
<p>Container 主要需要实现的方法是 addChild() 和 removeChild()</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">     * Add a new child Container to those associated with this Container,
</span><span style="color:#75715e">     * if supported.  Prior to adding this Container to the set of children,
</span><span style="color:#75715e">     * the child&#39;s &lt;code&gt;setParent()&lt;/code&gt; method must be called, with this
</span><span style="color:#75715e">     * Container as an argument.  This method may thrown an
</span><span style="color:#75715e">     * &lt;code&gt;IllegalArgumentException&lt;/code&gt; if this Container chooses not
</span><span style="color:#75715e">     * to be attached to the specified Container, in which case it is not added
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param child New child Container to be added
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @exception IllegalArgumentException if this exception is thrown by
</span><span style="color:#75715e">     *  the &lt;code&gt;setParent()&lt;/code&gt; method of the child Container
</span><span style="color:#75715e">     * @exception IllegalArgumentException if the new child does not have
</span><span style="color:#75715e">     *  a name unique from that of existing children of this Container
</span><span style="color:#75715e">     * @exception IllegalStateException if this Container does not support
</span><span style="color:#75715e">     *  child Containers
</span><span style="color:#75715e">     */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addChild</span><span style="color:#f92672">(</span>Container child<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">     * Remove an existing child Container from association with this parent
</span><span style="color:#75715e">     * Container.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param child Existing child Container to be removed
</span><span style="color:#75715e">     */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">removeChild</span><span style="color:#f92672">(</span>Container child<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>并且更具上面的注释，在实现add 方法的时候必须对传入的子容器设置父容器。</p>
<h2 id="host-和-engine-是什么">Host 和 Engine 是什么?</h2>
<p>如果你需要在Tomcat 上部署多个Context 容器的话，你需要使用Host 容器,如果只有一个Context 容器的话，理论上不需要Host 容器，但是在Tomcat 的实际部署的时候，总是会使用一个Host 容器。所以他基本只是作为一个包含Context 容器的父容器。</p>
<p>而Engine 容器则是处于最顶层的容器，默认情况下Tomcat 会使用Engine 容器并且Engine 容器中包含一个 Host 容器。</p>
<h2 id="管道">管道</h2>
<p>Tomcat 并没有采用遍历Valve 的方式去实现阀的遍历执行。也没有采用Tomcat4 之前的实现采用ValveContext的实现。</p>
<p>但是我们可以稍微了解下这个Valve Context 的实现。</p>
<p>类似于Java 的双亲委派机制。</p>
<p><img src="../doc/images/images.png" alt=""></p>
<p>对于每个阀调用的时候都会传入一个叫做ValveContext的实例。这个ValveContext 实例可以获取到这个管道中所有的阀，所以可以使用他的invokeNext  来调用之后的阀。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Request req<span style="color:#f92672">,</span>Response res<span style="color:#f92672">,</span>ValveContext context<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
  context<span style="color:#f92672">.</span><span style="color:#a6e22e">invokeNext</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>res<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
  <span style="color:#75715e">// 下面才是当前阀的逻辑
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>我觉得这里使用递归调用下面的阀的过程的好处是：</p>
<p>如果可以通过回搠可以对之前执行完成的阀进行一些额外的操作，如果你需要将当前的状态传递到下一个阀中去的话，就可以将invoke() 放置在方法末尾，如果你需要基于之前的阀进行操作的话，你可以将invoke()放置在方法开头，这样大大能提高用户DIY 代码的灵活性。</p>
<p><img src="../doc/images/345531-20160330111438473-1015724073.png" alt="img"></p>
<p>可以很清晰的看到，对于阀和阀之间都是采用双向箭头来表示，因为可以通过回搠回到上一个阀中。</p>
<p>在Tomcat 7的实现中则是将Valve 设置成为单项链表的实现，每个pipeline的基础阀在链表的尾部，并且如果有新的valve 被嵌入的时候，将他插入在尾部，并且在基础阀的前一个节点,这也是用普通的遍历所达不到的效果。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// Add this Valve to the set associated with this Pipeline
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>first <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  first <span style="color:#f92672">=</span> valve<span style="color:#f92672">;</span>
  valve<span style="color:#f92672">.</span><span style="color:#a6e22e">setNext</span><span style="color:#f92672">(</span>basic<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
  Valve current <span style="color:#f92672">=</span> first<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>current<span style="color:#f92672">.</span><span style="color:#a6e22e">getNext</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> basic<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      current<span style="color:#f92672">.</span><span style="color:#a6e22e">setNext</span><span style="color:#f92672">(</span>valve<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
      valve<span style="color:#f92672">.</span><span style="color:#a6e22e">setNext</span><span style="color:#f92672">(</span>basic<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    current <span style="color:#f92672">=</span> current<span style="color:#f92672">.</span><span style="color:#a6e22e">getNext</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>所以如果我们要调用Pipeline的话就会从链表头部开始调用直到调用到链表的末尾，去调用子容器的Pipeline 不断委托下去，这样有个好处就是可以将原本杂乱无章的代码逻辑，采用流水线的方式执行，并且能够让每个Valve 都有接触资源的机会，也方便于之后的代码维护，可以对阀进行有序的增删改。</p>
<p>Tomcat 所有容器的Valve 调用如下图所示:</p>
<p><img src="../doc/images/81282f8c4d26fcf5375392a2a856a4bc.png" alt="img"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CoyoteAdapter</span> <span style="color:#66d9ef">implements</span> Adapter <span style="color:#f92672">{</span>
   <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 适配器调用Engine的第一个阀
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">apache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">coyote</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Request</span> req<span style="color:#f92672">,</span>
                        org<span style="color:#f92672">.</span><span style="color:#a6e22e">apache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">coyote</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Response</span> res<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
  connector<span style="color:#f92672">.</span><span style="color:#a6e22e">getService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getContainer</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                          <span style="color:#f92672">.</span><span style="color:#a6e22e">getPipeline</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span>
                          invoke<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#75715e">// 一个复杂的调用
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StandardEngineValve</span>
    <span style="color:#66d9ef">extends</span> ValveBase <span style="color:#f92672">{</span>
  <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Engine 调用
</span><span style="color:#75715e">     */</span>
      <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Request request<span style="color:#f92672">,</span> Response response<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>

        <span style="color:#75715e">// Select the Host to be used for this Request
</span><span style="color:#75715e"></span>        Host host <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getHost</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>host <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendError</span>
                <span style="color:#f92672">(</span>HttpServletResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">SC_BAD_REQUEST</span><span style="color:#f92672">,</span>
                 sm<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;standardEngine.noHost&#34;</span><span style="color:#f92672">,</span> 
                              request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServerName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">isAsyncSupported</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAsyncSupported</span><span style="color:#f92672">(</span>host<span style="color:#f92672">.</span><span style="color:#a6e22e">getPipeline</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAsyncSupported</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Ask this Host to process this request
</span><span style="color:#75715e"></span>        host<span style="color:#f92672">.</span><span style="color:#a6e22e">getPipeline</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">*Context 调用 Wrapper 的第一个阀
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Request request<span style="color:#f92672">,</span> Response response<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>

        <span style="color:#75715e">// Disallow any direct access to resources under WEB-INF or META-INF
</span><span style="color:#75715e"></span>        MessageBytes requestPathMB <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestPathMB</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#f92672">(</span>requestPathMB<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWithIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/META-INF/&#34;</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">|</span><span style="color:#f92672">|</span> <span style="color:#f92672">(</span>requestPathMB<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/META-INF&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">|</span><span style="color:#f92672">|</span> <span style="color:#f92672">(</span>requestPathMB<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWithIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/&#34;</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">|</span><span style="color:#f92672">|</span> <span style="color:#f92672">(</span>requestPathMB<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendError</span><span style="color:#f92672">(</span>HttpServletResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">SC_NOT_FOUND</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Select the Wrapper to be used for this Request
</span><span style="color:#75715e"></span>        Wrapper wrapper <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getWrapper</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wrapper <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">isUnavailable</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendError</span><span style="color:#f92672">(</span>HttpServletResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">SC_NOT_FOUND</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Acknowledge the request
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendAcknowledgement</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException ioe<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            container<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>sm<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span>
                    <span style="color:#e6db74">&#34;standardContextValve.acknowledgeException&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> ioe<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>RequestDispatcher<span style="color:#f92672">.</span><span style="color:#a6e22e">ERROR_EXCEPTION</span><span style="color:#f92672">,</span> ioe<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendError</span><span style="color:#f92672">(</span>HttpServletResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">SC_INTERNAL_SERVER_ERROR</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">isAsyncSupported</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAsyncSupported</span><span style="color:#f92672">(</span>wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getPipeline</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAsyncSupported</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getPipeline</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

</code></pre></div><ul class="pa0">
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://xiantang.github.io/" >
    &copy;  xiantang 2020 
  </a>
    <div>












</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
